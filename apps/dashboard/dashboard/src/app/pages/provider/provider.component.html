<div *ngIf="loading" class="p-16 text-center text-gray-400 text-lg">
    Loading provider...
</div>

<div *ngIf="!loading" class="max-w-5xl mx-auto p-8">

    <!-- HEADER -->
    <div class="mb-10">
        <h1 class="text-4xl font-bold tracking-tight">{{ provider.name }}</h1>

        <div class="flex items-center gap-3 mt-3">
            <span class="w-3 h-3 rounded-full" [ngClass]="{
          'bg-green-500': provider.status==='operational',
          'bg-orange-400': provider.status==='degraded',
          'bg-red-500': provider.status==='down'
        }">
            </span>

            <span class="text-sm font-semibold px-3 py-1 rounded-full" [ngClass]="{
          'bg-green-100 text-green-700': provider.status==='operational',
          'bg-orange-100 text-orange-700': provider.status==='degraded',
          'bg-red-100 text-red-700': provider.status==='down'
        }">
                {{ provider.status | titlecase }}
            </span>

            <span class="text-gray-400 text-sm">
                • Last check: {{ formatDate(provider.lastCheckAt) }}
            </span>

            <span class="text-gray-400 text-sm">
                • Trend: {{ provider.trend }}
            </span>
        </div>
    </div>


    <!-- METRICS -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-14">

        <div class="p-6 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition">
            <h3 class="text-xs uppercase tracking-wide text-gray-500">Last latency</h3>
            <p class="text-3xl font-semibold mt-1">{{ provider.lastLatency }} ms</p>
        </div>

        <div class="p-6 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition">
            <h3 class="text-xs uppercase tracking-wide text-gray-500">Avg latency (3h)</h3>
            <p class="text-3xl font-semibold mt-1">{{ provider.avgLatency3h }} ms</p>
        </div>

        <div class="p-6 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition">
            <h3 class="text-xs uppercase tracking-wide text-gray-500">Uptime 24h</h3>
            <p class="text-3xl font-semibold mt-1">{{ provider.uptime24h | number:'1.0-2' }}%</p>
        </div>

    </div>


    <!-- GRAPH -->
    <h2 class="text-2xl font-bold mb-4">Latency history</h2>

    <div class="bg-white border border-gray-100 shadow-sm rounded-xl p-6 mb-12">
        <canvas #latencyChart height="130"></canvas>
    </div>


    <!-- INCIDENTS -->
    <h2 class="text-xl font-semibold mt-10 mb-4">Incident History</h2>

    <div *ngIf="incidents.length === 0" class="text-gray-500 text-sm">
        No incidents recorded for this provider.
    </div>

    <div *ngIf="incidents.length > 0" class="relative pl-6">

        <!-- vertical line -->
        <div class="absolute top-0 left-2 w-0.5 bg-gray-200 h-full"></div>

        <div *ngFor="let incident of incidents" class="relative mb-6">

            <!-- dot -->
            <div class="absolute -left-1 top-2 w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow"></div>

            <div class="p-4 bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition">

                <!-- Top row -->
                <div class="flex items-center justify-between">

                    <span class="text-sm font-medium text-red-600 flex items-center gap-2">
                        <span class="px-2 py-0.5 rounded-full bg-red-100 text-red-600 text-xs">
                            {{ incident.type }}
                        </span>
                        {{ incident.message }}
                    </span>

                    <span class="text-xs text-gray-400">
                        {{ incident.startAt | date : 'dd/MM/yyyy HH:mm:ss' }}
                    </span>
                </div>

                <!-- Duration -->
                <div class="mt-2 text-xs text-gray-600">
                    Duration:
                    <span class="font-medium">
                        {{ getDuration(incident.startAt, incident.endAt) }}
                    </span>
                </div>

            </div>

        </div>
    </div>


</div>